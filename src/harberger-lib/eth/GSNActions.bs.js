// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE

import * as Block from "bs-platform/lib/es6/block.js";
import * as Curry from "bs-platform/lib/es6/curry.js";
import * as React from "react";
import * as Ethers from "ethers";
import * as $$Promise from "reason-promise/src/js/promise.js";
import * as Belt_Option from "bs-platform/lib/es6/belt_Option.js";
import * as BiconomyExec from "./biconomy-exec";
import * as Core from "@web3-react/core";
import * as Globals$WildCards from "../Globals.bs.js";
import * as RootProvider$WildCards from "../RootProvider.bs.js";
import * as VoteContractJson from "./abi/voteContract.json";
import * as WrapSignerInGsnProvider from "./wrapSignerInGsnProvider";

var execTestTx = BiconomyExec.execTestTx;

var wrapSignerInGsnProvider = WrapSignerInGsnProvider.default;

function getProviderOrSigner(library, account, isGsn) {
  console.log("Getting the signer", account, isGsn);
  if (account !== undefined) {
    if (isGsn) {
      return wrapSignerInGsnProvider(library.provider, library.getSigner(account), account);
    } else {
      console.log("The account we are using", account);
      return library.getSigner(account);
    }
  } else {
    return library;
  }
}

var voteContract = VoteContractJson.voteContract;

function getExchangeContract(stewardAddress, stewardAbi, library, account, isGsn) {
  console.log("Getting the contract instance");
  return new Ethers.Contract(stewardAddress, stewardAbi, getProviderOrSigner(library, account, isGsn));
}

var erc20 = "0x80615a1A1c9E31aa2dCd605592e8A1e674A0c0Bd";

function useStewardAbi(param) {
  return (require("./gsn-steward-abi.json"));
}

function defaultStewardAddressFromChainId(param) {
  return erc20;
}

function useStewardAddress(param) {
  var externallySetAddress = RootProvider$WildCards.useStewardContractAddress(undefined);
  return (function (chainId) {
      return Belt_Option.mapWithDefault(externallySetAddress, erc20, (function (a) {
                    return a;
                  }));
    });
}

function useStewardContract(isGsn) {
  var context = Core.useWeb3React();
  var address = context.account;
  var stewardContractAddress = useStewardAddress(undefined);
  var stewardAbi = useStewardAbi(undefined);
  console.log("address", address);
  var match = context.library;
  var match$1 = context.chainId;
  if (match !== undefined && match$1 !== undefined) {
    return /* tuple */[
            Globals$WildCards.oMap(Curry._1(stewardContractAddress, match$1), (function (__x) {
                    return getExchangeContract(__x, stewardAbi, match, context.account, isGsn);
                  })),
            address
          ];
  } else {
    return /* tuple */[
            undefined,
            undefined
          ];
  }
}

function useMint(isGsn) {
  var match = React.useState((function () {
          return /* UnInitialised */0;
        }));
  var setTxState = match[1];
  var match$1 = useStewardContract(isGsn);
  var from = match$1[1];
  var optSteward = match$1[0];
  return /* tuple */[
          (function (param) {
              var value = Ethers.utils.parseUnits("0", 18);
              console.log("This is something");
              Curry._1(setTxState, (function (param) {
                      return /* Created */1;
                    }));
              if (optSteward === undefined) {
                return ;
              }
              var buyPromise = $$Promise.Js.toResult(optSteward.testFunctionThatDoesNothing("0xeb2D9aAfD2b3d74D288c022Ab5b58396A4a6c677", {
                        value: value,
                        from: from
                      }));
              $$Promise.getOk(buyPromise, (function (tx) {
                      Curry._1(setTxState, (function (param) {
                              return /* SignedAndSubmitted */Block.__(0, [tx.hash]);
                            }));
                      var txMinedPromise = $$Promise.Js.toResult(tx.wait());
                      $$Promise.getOk(txMinedPromise, (function (txOutcome) {
                              console.log(txOutcome);
                              return Curry._1(setTxState, (function (param) {
                                            return /* Complete */Block.__(2, [txOutcome]);
                                          }));
                            }));
                      $$Promise.getError(txMinedPromise, (function (error) {
                              Curry._1(setTxState, (function (param) {
                                      return /* Failed */2;
                                    }));
                              console.log(error);
                              
                            }));
                      
                    }));
              $$Promise.getError(buyPromise, (function (error) {
                      return Curry._1(setTxState, (function (param) {
                                    return /* Declined */Block.__(1, [error.message]);
                                  }));
                    }));
              
            }),
          match[0]
        ];
}

export {
  execTestTx ,
  wrapSignerInGsnProvider ,
  getProviderOrSigner ,
  voteContract ,
  getExchangeContract ,
  erc20 ,
  useStewardAbi ,
  defaultStewardAddressFromChainId ,
  useStewardAddress ,
  useStewardContract ,
  useMint ,
  
}
/* execTestTx Not a pure module */
